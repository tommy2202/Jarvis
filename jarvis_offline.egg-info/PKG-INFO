Metadata-Version: 2.4
Name: jarvis-offline
Version: 0.1.0
Summary: Secure, offline-first Jarvis assistant (minimal architecture proof).
Requires-Python: >=3.11
Description-Content-Type: text/markdown
Requires-Dist: cryptography>=42.0.0
Requires-Dist: fastapi>=0.110.0
Requires-Dist: pydantic>=2.6.0
Requires-Dist: requests>=2.31.0
Requires-Dist: rich>=13.7.0
Requires-Dist: uvicorn>=0.27.0
Provides-Extra: dev
Requires-Dist: httpx>=0.27.0; extra == "dev"
Requires-Dist: pytest>=8.0.0; extra == "dev"

## Jarvis (offline-first, secure, minimal)

This repo is a **minimal but functional** “Jarvis” assistant designed to run **offline-first** on Windows, with:

- **Config-driven Stage-A intent router** (keyword matching + confidence + basic args)
- **Stage-B local LLM fallback** (local HTTP to a model server, safe mock mode)
- **Single enforcement point** (dispatcher enforces permissions + admin gating)
- **Admin session** (passphrase hash stored in **encrypted secure store**; inactivity timeout)
- **USB-key encryption** (AES-GCM; default USB key path `E:\JARVIS_KEY.bin`)
- **Robust logging** (`logs/jarvis.log` + `logs/events.jsonl` with redaction)
- **CLI REPL** (`app.py`)
- **FastAPI remote control** (authenticated via API key stored **only** in encrypted secure store)
- **Module setup wizard** (detects modules and guides configuration)

## Windows setup

### 1) Create a venv + install dependencies

```bash
py -3.11 -m venv .venv
.venv\Scripts\activate
python -m pip install -U pip
pip install -e ".[dev]"
```

### 2) Create the USB key (required for admin + secure store + web API key)

Insert your USB drive (default `E:\`), then:

```bash
python scripts\create_usb_key.py
```

This creates: `E:\JARVIS_KEY.bin`

### 3) Create/rotate the web API key (encrypted; USB required)

```bash
python scripts\rotate_api_key.py
```

It prints the new API key once; store it somewhere safe.

### 4) Enable the web server (optional)

Edit `config/web.json`:

- set `"enabled": true`
- set `"host": "0.0.0.0"` to allow LAN access (or keep `"127.0.0.1"` for local-only)
- set `"port": 8787` (or any free port)

Security note:
- If the **USB key is missing**, Jarvis will only bind the web server to **localhost** and **remote control endpoints will be disabled**.

## Running Jarvis

```bash
python app.py
```

CLI commands:
- `/admin unlock` (prompts for passphrase; no echo)
- `/admin lock`
- `/exit`

## Remote control (FastAPI)

When enabled, the server provides:
- `GET /health`
- `POST /v1/message` (requires `X-API-Key`)
- `POST /v1/admin/unlock` (requires `X-API-Key`; **localhost only by default**)
- `GET /` (tiny web UI, optional)

Example request:

```bash
curl -X POST "http://<jarvis-host>:8787/v1/message" ^
  -H "Content-Type: application/json" ^
  -H "X-API-Key: <YOUR_KEY>" ^
  -d "{\"message\":\"play Coldplay on Spotify\",\"client\":{\"name\":\"phone\"}}"
```

## Adding a module (setup wizard workflow)

1) Drop a new module file in `jarvis/modules/` with:
- `MODULE_META = {"id": "...", ...}`
- `handle(intent_id, args, context) -> dict`

2) Add it to `config/modules_registry.json` (or let the wizard detect it):

```json
{
  "modules": [
    {"module":"jarvis.modules.my_new_module","enabled": false}
  ]
}
```

3) Restart `python app.py`.
If the module is missing routing/permissions/confirmation config, Jarvis will prompt you through setup:
- admin-only?
- resource-intensive? (forces admin-only)
- needs network?
- keywords for routing
- confirmation template

Non-sensitive values go to `config/*.json`.
Secrets (if the module declares them) go into the **encrypted secure store** (USB required).

To run the wizard manually:

```bash
python scripts/jarvis_setup.py
```

## Local model server (optional)

Stage-B is designed to call a **local** model server via HTTP and validates strict JSON output.
If no local server is running, it falls back to **safe mock mode** (never executes unknown intents).

You can run a local server via Ollama or llama.cpp with an OpenAI-compatible endpoint.
Update `config/security.json` → `llm.base_url` and `llm.model`.
